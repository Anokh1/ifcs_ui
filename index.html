<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>IFCS Dashboard</title>
    <style>
      body {
        margin: 0;
        font-family: "Segoe UI", sans-serif;
        background: #0f1220;
        color: #eaeaf0;
        position: relative;
        overflow-x: hidden;
      }

      header {
        padding: 16px 24px;
        background: #151933;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      header h1 {
        margin: 0;
        font-size: 20px;
      }
      header span {
        font-size: 14px;
        opacity: 0.8;
      }

      .dashboard {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 16px;
        padding: 16px;
      }

      .card {
        background: #1c2140;
        border-radius: 12px;
        padding: 16px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        position: relative;
      }

      h3 {
        margin-top: 0;
        margin-bottom: 10px;
        font-size: 16px;
      }

      /* .top-actions {
        grid-column: 1 / -1;
        display: flex;
        justify-content: flex-end;
        gap: 8px;
      } */
      .top-actions {
        grid-column: 1 / -1;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 16px;
      }

      .top-stats {
        display: flex;
        gap: 12px;
      }

      .stat-card {
        background: #1c2140;
        border-radius: 8px;
        padding: 10px 14px;
        text-align: center;
        min-width: 80px;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .stat-card h4 {
        margin: 0;
        font-size: 12px;
        font-weight: normal;
        opacity: 0.7;
      }

      .stat-card p {
        margin: 0;
        font-size: 14px;
        font-weight: bold;
      }

      .btn {
        background: #2b5cff;
        border: none;
        color: white;
        padding: 10px 16px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.2s ease;
      }
      .btn:hover {
        background: #1f4ae0;
      }

      /* Popover styling */
      .popover {
        position: absolute;
        top: 100%;
        transform: translateY(8px);
        background: #1c2140;
        padding: 16px 20px;
        border-radius: 12px;
        box-shadow: 0 0 25px rgba(255, 255, 255, 0.2);
        z-index: 1000;
        min-width: 300px;
        max-width: 400px;
        display: none;
      }
      .slideIn {
        animation: slideIn 0.4s ease-out forwards;
      }
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(12px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .glow {
        animation: glowPulse 1.8s infinite;
      }
      @keyframes glowPulse {
        0% {
          box-shadow: 0 0 10px rgba(255, 77, 79, 0.3);
        }
        50% {
          box-shadow: 0 0 25px rgba(255, 77, 79, 0.8);
        }
        100% {
          box-shadow: 0 0 10px rgba(255, 77, 79, 0.3);
        }
      }

      .ai-loading {
        display: flex;
        align-items: center;
        gap: 12px;
        opacity: 0.9;
      }
      .spinner {
        width: 22px;
        height: 22px;
        border: 3px solid rgba(255, 255, 255, 0.2);
        border-top: 3px solid #2b5cff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .ai-result-animate {
        animation: fadeInUp 0.5s ease-out;
      }
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      canvas {
        background: #1c2140;
        border-radius: 8px;
      }

      footer {
        padding: 10px;
        text-align: center;
        font-size: 12px;
        opacity: 0.6;
      }

      .timeline-container {
        grid-column: 1 / -1;
      }
      .timeline {
        display: flex;
        height: 10px; /* thinner */
        border-radius: 5px;
        overflow: hidden;
        margin-top: 8px;
      }
      .slot {
        flex: 1;
      }
      .normal {
        background: #52c41a;
      }
      .warning {
        background: #fadb14;
      }
      .critical {
        background: #ff4d4f;
      }
      .legend {
        display: flex;
        gap: 8px;
        margin-top: 6px;
        font-size: 11px;
      }
      .legend span {
        display: flex;
        align-items: center;
        gap: 6px;
      }
      .dot {
        width: 8px;
        height: 8px;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>IFCS Dashboard</h1>
      <span>Machine: Line-A-01 | Shift: Morning</span>
    </header>

    <div class="dashboard">
      <!-- <div class="top-actions" id="actionButtons">
        <button class="btn" id="anomalyBtn">Anomaly Story</button>
        <button class="btn" id="maintenanceBtn">
          Maintenance Recommendation
        </button>
      </div> -->
      <div class="top-actions">
        <div class="top-stats">
          <div class="stat-card">
            <h4>Total Defects</h4>
            <p id="totalDefects">33</p>
          </div>
          <div class="stat-card">
            <h4>Yield %</h4>
            <p id="totalYield">92</p>
          </div>
          <div class="stat-card">
            <h4>OEE %</h4>
            <p id="totalOEE">85</p>
          </div>
          <div class="stat-card">
            <h4>Scrap %</h4>
            <p id="totalScrap">5</p>
          </div>
        </div>

        <div class="action-buttons">
          <button class="btn" id="anomalyBtn">Anomaly Story</button>
          <button class="btn" id="maintenanceBtn">
            Maintenance Recommendation
          </button>
        </div>
      </div>

      <!-- Charts -->
      <div class="card">
        <h3>Production Defects</h3>
        <canvas id="defectsChart"></canvas>
      </div>
      <div class="card">
        <h3>Yield Rate (%)</h3>
        <canvas id="yieldChart"></canvas>
      </div>
      <div class="card">
        <h3>OEE (%)</h3>
        <canvas id="oeeChart"></canvas>
      </div>
      <div class="card">
        <h3>Scrap Rate (%)</h3>
        <canvas id="scrapChart"></canvas>
      </div>

      <!-- Timeline -->
      <div class="card timeline-container">
        <h3>Risk & Maintenance Timeline</h3>
        <div class="timeline" id="timelineBar"></div>
        <div class="legend">
          <span
            ><div class="dot normal"></div>
            Normal</span
          >
          <span
            ><div class="dot warning"></div>
            Warning</span
          >
          <span
            ><div class="dot critical"></div>
            Critical</span
          >
        </div>
      </div>
    </div>

    <!-- Popovers -->
    <div id="storyPopover" class="popover">
      <h3>Anomaly Storytelling</h3>
      <div id="storyLoading" class="ai-loading">
        <div class="spinner"></div>
        <p>AI analyzing anomaly…</p>
      </div>
      <div id="storyContent" class="hidden">
        <p id="storyText"></p>
      </div>
    </div>

    <div id="maintenancePopover" class="popover">
      <h3>Maintenance Recommendation</h3>
      <div id="aiLoading" class="ai-loading">
        <div class="spinner"></div>
        <p>AI analyzing machine condition & risk patterns…</p>
      </div>
      <div id="aiResult" class="hidden">
        <p>Recommended Window: <strong id="maintenanceWindow"></strong></p>
        <p>Urgency: <span id="urgencyLevel"></span></p>
        <p>Expected Risk If Delayed: <strong id="riskIncrease"></strong></p>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      const aiData = {
        anomalyText:
          "Cooling Unit failure detected, may affect Packaging Module. Risk HIGH.",
        maintenanceWindow: "02:00 – 03:00",
        urgency: "MEDIUM",
        delayRisk: "+12%",
        timeline: ["normal", "normal", "warning", "critical", "critical"],
        defects: [12, 7, 5, 9],
        yield: [92, 95, 90, 93],
        oee: [85, 88, 82, 87],
        scrap: [5, 4, 6, 3],
      };

      // Helper to position popover below a button
      function positionPopover(button, popover) {
        const rect = button.getBoundingClientRect();
        const popoverWidth = popover.offsetWidth;
        let left = rect.left + window.scrollX;

        // If popover overflows right edge, move it to the left of button
        if (left + popoverWidth > window.innerWidth - 10) {
          left = rect.right - popoverWidth; // align right edge with button right edge
        }

        popover.style.top = rect.bottom + window.scrollY + 8 + "px";
        popover.style.left = left + "px";
      }

      // Anomaly Story popover
      const anomalyBtn = document.getElementById("anomalyBtn");
      const storyPopover = document.getElementById("storyPopover");
      const storyLoading = document.getElementById("storyLoading");
      const storyContent = document.getElementById("storyContent");
      const storyText = document.getElementById("storyText");

      anomalyBtn.addEventListener("click", () => {
        if (storyPopover.style.display === "block") {
          storyPopover.style.display = "none";
          storyContent.classList.add("hidden");
          storyLoading.style.display = "flex";
        } else {
          storyPopover.style.display = "block";
          storyPopover.classList.add("slideIn", "glow");
          storyText.innerText = aiData.anomalyText;
          storyLoading.style.display = "flex";
          storyContent.classList.add("hidden");
          positionPopover(anomalyBtn, storyPopover);
          setTimeout(() => {
            storyLoading.style.display = "none";
            storyContent.classList.remove("hidden");
          }, 3000);
          setTimeout(() => storyPopover.classList.remove("glow"), 3000);
        }
      });

      // Maintenance popover
      const maintenanceBtn = document.getElementById("maintenanceBtn");
      const maintenancePopover = document.getElementById("maintenancePopover");
      const aiLoading = document.getElementById("aiLoading");
      const aiResult = document.getElementById("aiResult");

      maintenanceBtn.addEventListener("click", () => {
        if (maintenancePopover.style.display === "block") {
          maintenancePopover.style.display = "none";
          aiResult.classList.add("hidden");
          aiLoading.style.display = "flex";
        } else {
          maintenancePopover.style.display = "block";
          maintenancePopover.classList.add("slideIn", "glow");
          aiLoading.style.display = "flex";
          aiResult.classList.add("hidden");
          positionPopover(maintenanceBtn, maintenancePopover);
          setTimeout(() => {
            aiLoading.style.display = "none";
            aiResult.classList.remove("hidden");
            aiResult.classList.add("ai-result-animate");
            document.getElementById("maintenanceWindow").innerText =
              aiData.maintenanceWindow;
            document.getElementById(
              "urgencyLevel"
            ).innerHTML = `<span style="color:#fadb14;font-weight:bold">${aiData.urgency}</span>`;
            document.getElementById("riskIncrease").innerText =
              aiData.delayRisk;
            setTimeout(() => maintenancePopover.classList.remove("glow"), 3000);
          }, 3000);
        }
      });

      // Timeline
      const timelineBar = document.getElementById("timelineBar");
      aiData.timeline.forEach((level) => {
        const div = document.createElement("div");
        div.className = `slot ${level}`;
        timelineBar.appendChild(div);
      });

      // Charts
      new Chart(document.getElementById("defectsChart"), {
        type: "bar",
        data: {
          labels: ["Module A", "Module B", "Module C", "Module D"],
          datasets: [
            {
              label: "Defects",
              data: aiData.defects,
              backgroundColor: ["#ff4d4f", "#fadb14", "#52c41a", "#2b5cff"],
              barPercentage: 0.4,
              categoryPercentage: 0.4,
            },
          ],
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true }, x: { grid: { display: false } } },
        },
      });

      new Chart(document.getElementById("yieldChart"), {
        type: "line",
        data: {
          labels: ["Week 1", "Week 2", "Week 3", "Week 4"],
          datasets: [
            {
              label: "Yield %",
              data: aiData.yield,
              borderColor: "#52c41a",
              backgroundColor: "rgba(82,196,26,0.2)",
              fill: true,
              tension: 0.3,
              pointRadius: 5,
              pointHoverRadius: 8,
            },
          ],
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true, max: 100 } },
        },
      });

      new Chart(document.getElementById("oeeChart"), {
        type: "line",
        data: {
          labels: ["Week 1", "Week 2", "Week 3", "Week 4"],
          datasets: [
            {
              label: "OEE %",
              data: aiData.oee,
              borderColor: "#ffadad",
              backgroundColor: "rgba(255,173,173,0.2)",
              fill: true,
              tension: 0.3,
              pointRadius: 5,
            },
          ],
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true, max: 100 } },
        },
      });

      new Chart(document.getElementById("scrapChart"), {
        type: "bar",
        data: {
          labels: ["Week 1", "Week 2", "Week 3", "Week 4"],
          datasets: [
            {
              label: "Scrap %",
              data: aiData.scrap,
              backgroundColor: ["#caffbf", "#9bf6ff", "#ffc6ff", "#b5ead7"],
              barPercentage: 0.4,
              categoryPercentage: 0.4,
            },
          ],
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true } },
        },
      });
    </script>
  </body>
</html>
